<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="favicon.ico">
  <meta name="viewport" content="width=device-width, user-scalable=no">

  <title>Made with Needle</title>

  <meta property="og:title" content="Made with Needle" />
  <meta name="description" content="ðŸŒµ Made with Needle Engine">
  <meta property="og:description" content="ðŸŒµ Made with Needle Engine" />

  <meta name="robots" content="index,follow">
  <meta name="url" content="http://needle.tools">

  <link rel="stylesheet" href="src/styles/mainmenu.css">
  <link rel="stylesheet" href="./src/styles/style.css">
</head>

<body>
  <script type="module" src="./src/generated/gen.js"></script>
  <script type="module" src="./src/main.ts"></script>

  <div class="mainmenu">
    <button class="room open-submenu"><span class="state-icon"><img src="include/icon-room-state.svg"
          alt="Room-State"></span><span class="icon"><img src="include/icon-room.svg" alt="Room"></span></button>
    <button class="help open-submenu"><span class="icon"><img src="include/icon-help.svg" alt="Help"></span></button>
    <button class="participants open-submenu"><span class="icon"><img src="include/icon-participants.svg"
          alt="Participants"></span></button>
    <button class="share open-submenu"><span class="icon"><img src="include/icon-share.svg" alt="Share"></span></button>
    <button class="mic" id="mic-button"><span class="icon"><img src="include/icon-mic-on.svg"
          alt="Mic-On"></span></button>
  </div>

  <div id="submenu" class="submenu">
    <h2 class="submenu-title"></h2>
    <div class="submenu-content">
    </div>
  </div>

  <script>
    const micButton = document.getElementById('mic-button');
    const micIcon = micButton.querySelector('.icon img');

    micButton.addEventListener('click', function () {
      micIcon.src = micIcon.src.includes('icon-mic-on.svg') ? 'include/icon-mic-off.svg' : 'include/icon-mic-on.svg';
      micButton.style.backgroundColor = micIcon.src.includes('icon-mic-on.svg') ? 'white' : '#E50128';
    });

    const submenus = {
      room: {
        title: "Room Settings",
        items: [
          { icon: "include/icon-room-create.svg", text: "Create new Room" },
          { icon: "include/icon-room-share.svg", text: "Share Room" },
          { icon: "include/icon-room-password.svg", text: "Set Room Password" },
          { icon: "include/icon-room-leave.svg", text: "Leave Room" },
          { icon: "include/icon-state.svg", text: "Connected", special: true },
        ],
      },
      help: {
        title: "How to move",
        content: "<img src='include/instruction.png' alt='How to move Instructions'>",
      },
      participants: {
        title: "Participants",
        items: [
          { icon: "include/icon-edit.svg", text: "Crazy Duck (You)" },
          { icon: "include/icon-person.svg", text: "Flying Dutchman" },
          { icon: "include/icon-person.svg", text: "Magic Mike" },
        ],
      },
      share: {
        title: "Share",
        items: [
          { icon: "include/icon-share-camera.svg", text: "Camera" },
          { icon: "include/icon-share-screen.svg", text: "Screen" },
          { icon: "include/icon-share-window.svg", text: "Single Window" },
        ],
      },
    };

    const submenu = document.getElementById("submenu");
    const submenuContent = submenu.querySelector(".submenu-content");
    let currentSubMenu = null;

    function toggleSubmenu(menuType) {
      if (currentSubMenu === menuType) {
        closeSubmenu();
      } else {
        openSubmenu(menuType);
      }
    }

    function openSubmenu(menuType) {
      closeSubmenu();
      const submenuData = submenus[menuType];

      if (!submenuData) {
        console.error(`SubMenu "${menuType}" not found in submenus.`);
        return;
      }

      document.querySelector(".submenu-title").textContent = submenuData.title || "Fallback Title";

      submenuContent.innerHTML = submenuData.content || "";

      submenuData.items.forEach((item) => {
        const submenuItem = document.createElement("button");

        if (item.special) {
          submenuItem.classList.add("special");
        } else {
          submenuItem.classList.add("submenu-button");
        }
        const icon = document.createElement("img");
        icon.src = item.icon;
        const buttonText = document.createTextNode(item.text);
        submenuItem.appendChild(icon);
        submenuItem.appendChild(buttonText);
        submenuContent.appendChild(submenuItem);
      });

      submenu.classList.add("open");
      currentSubMenu = menuType;
    }

    function closeSubmenu() {
      submenu.classList.remove("open");
      currentSubMenu = null;
    }

    function hideSubmenu() {
      submenu.classList.remove("open");
      currentSubMenu = null;
    }

    function initializePage() {

      hideSubmenu();

      document.querySelector(".room").addEventListener("click", () => {
        toggleSubmenu("room");
      });

      document.querySelector(".help").addEventListener("click", () => {
        toggleSubmenu("help");
      });

      document.querySelector(".participants").addEventListener("click", () => {
        toggleSubmenu("participants");
      });

      document.querySelector(".share").addEventListener("click", () => {
        toggleSubmenu("share");
      });


      document.querySelector(".submenu-title").addEventListener("click", () => {
        hideSubmenu();
      });
    }

    initializePage();

  </script>

  <needle-engine></needle-engine>

</body>

</html>